/*
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
Nextflow config file for Digital Research Alliance of Canada Narval Cluster for 
the SLURM login nodes
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
*/

apptainer {
    enabled = true
    autoMounts = true
    runOptions = "-B /project/ctb-noncodo/Platform/references"
    libraryDir = "$HOME/scratch/apptainer_lib/"
    cacheDir = "\${SLURM_TMPDIR}/apptainer_cache"  
    pullTimeout = '180 min'
}

env {
    APPTAINER_CACHEDIR = "\${SLURM_TMPDIR}"  
    APPTAINER_TMPDIR = "\${SLURM_TMPDIR}"
    SINGULARITY_CACHEDIR = "\${SLURM_TMPDIR}"
    SINGULARITY_TMPDIR = "\${SLURM_TMPDIR}"
}

process {
    executor = 'slurm'
    array = 96
    errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'ignore' }
    scratch = "\$SLURM_TMPDIR"  
    
    withName: 'PYCHOPPER' {
        label = "process_medium_low_time"
    }
}