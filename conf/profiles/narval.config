process {
    withLabel: 'local' {
        executor = 'local'
        maxForks = 3   // or whatever makes sense for your machine
    }
    withLabel: '!local' {
        executor = 'slurm'
        array = 96
        errorStrategy = { task.exitStatus in ((130..145) + 104) ? 'retry' : 'ignore' }
    }
}

executor {
  $slurm {
      pollInterval    = '60 sec'
      submitRateLimit = '60/1min'
      queueSize       = 100
  }
}

params {
        max_memory='249G'
        max_cpus=64
        max_time='168h'
        publish_dir_mode = 'link'
}
apptainer {
        enabled=true
        autoMounts=true
        runOptions = "-C -B /project/ctb-noncodo/Platform/references --writable-tmpfs"
        libraryDir = "$HOME/.apptainer/cache"
        cacheDir = "$HOME/.apptainer/cache"
        pullTimeout = '60 min'
}